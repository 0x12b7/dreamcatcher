import{Unsafe as e,Some as n,None as r,Ok as t,Err as a,Fpv as i,flag as E,wrap as u,wrapAsync as R}from"@tokyo/reliq";import{Contract as o,ContractFactory as s,Interface as l,BrowserProvider as N}from"ethers";async function c(){let E,L,f,A=r;return(await async function(){if(void 0===window)return a({code:"WALLET.ERR_UNSUPPORTED_OPERATION",data:r,message:n("Wallet: ..."),reason:r,transaction:r});if("ethereum"in window==!1)return a({code:"WALLET.ERR_UNSUPPORTED_OPERATION",data:r,message:n("Wallet: ..."),reason:r,transaction:r});let e=S(u((()=>new N(window.ethereum))));if(e.err())return e;let i=e.unwrap(),E=await S(R((async()=>i.send("eth_accounts",[]))));if(E.err())return E;let o=E.unwrap();if(o.length>0)return t([i,o]);let s=await S(R((async()=>i.send("eth_requestAccounts",[]))));if(s.err())return s;let l=s.unwrap();return l.length>0?t([i,l]):a({code:"WALLET.ERR_UNCONFIGURED_NAME",data:r,message:r,reason:r,transaction:r})}()).map((([e,n])=>(L=e,f=n,E={use:T,connected:_,address:w,nonce:I,query:p,touch:g,deploy:U})));async function T(e){let n=await S(R((async()=>await L.getSigner("string"==typeof e?e:Number(e)))));return n.err()?n:t(E)}function _(e){return e&&A.some()?new Promise((n=>{let r=A.unwrap();S(R((async()=>await r.getAddress()))).then((r=>{if(!r.ok())return r;{let a=r.unwrap();n(t(a===e))}}))})):A.some()}async function w(){return await S(R((async()=>await(await L.getSigner()).getAddress())))}async function I(){return(await S(R((async()=>(await L.getSigner()).getNonce())))).map((e=>BigInt(e)))}async function p(n){let r;if(A.none()){let e=await S(R((async()=>await L.getSigner())));if(e.err())return e;let n=e.unwrap();r=n}else r=A.unwrap();let a=S(u((()=>new o(n.to,[n.signature],r))));if(a.err())return a;let i=a.unwrap(),E=S(u((()=>i.getFunction(n.signature))));if(E.err())return E;let s=E.unwrap(),l=await S(R((async()=>e(await s(...n.payload??[])))));if(l.err())return l;let N=l.unwrap();return t(N)}async function g(e){let E;if(A.none()){let e=await S(R((async()=>await L.getSigner())));if(e.err())return e;let n=e.unwrap();E=n}else E=A.unwrap();let o=await w();if(o.err())return o;let s=o.unwrap(),N=await I();if(N.err())return N;let f=N.unwrap(),T=S(u((()=>new l([e.signature]))));if(T.err())return T;let _=T.unwrap(),p=c.Signature.nameOf(e.signature);if(p.none())return a({code:"WALLET.ERR_MALFORMED_SIGNATURE",data:r,message:r,reason:r,transaction:r});let g=p.unwrap(),U=S(u((()=>_.encodeFunctionData(g,e.payload))));if(U.err())return U;let O=U.unwrap(),d=e.gasPrice?i.Calculator.unwrap(e.gasPrice):0n,m=e.gasLimit?i.Calculator.unwrap(e.gasLimit):0n,D=await S(R((async()=>await E.sendTransaction({from:s,to:e.to,nonce:Number(f),gasPrice:d,gasLimit:m,data:O}))));if(D.err())return D;let W=D.unwrap();if(null===W)return a({code:"WALLET.ERR_INVALID_RESPONSE",data:r,message:r,transaction:r,reason:r});let P=await S(R((async()=>await W.wait(Number(e.confirmations),Number(e.timeout)))));if(P.err())return P;let C=P.unwrap();return t(null===C?r:n(C))}async function U(e){let n;if(A.none()){let e=await S(R((async()=>await L.getSigner())));if(e.err())return e;let r=e.unwrap();n=r}else n=A.unwrap();let r=S(u((()=>new s(e.abi,e.bytecode,n))));if(r.err())return r;let a=r.unwrap(),i=await S(R((async()=>await a.deploy(e.payload))));if(i.err())return i;let E=i.unwrap(),o=await S(R((async()=>await E.getAddress())));if(o.err())return o;let l=o.unwrap();return t(l)}function S(e){if("then"in e){return e.then((e=>S(e)))}if("ok"in e){return e.mapErr((e=>S(e)))}let t=e.inspect();if(null==t||"object"!=typeof t||!("code"in t)||"string"!=typeof t.code)return{code:"WALLET.ERR_UNKNOWN",data:r,message:r,reason:r,transaction:r};let a={UNKNOWN_ERROR:"WALLET.ERR_UNKNOWN",NOT_IMPLEMENTED:"WALLET.ERR_NOT_IMPLEMENTED",UNSUPPORTED_OPERATION:"WALLET.ERR_UNSUPPORTED_OPERATION",NETWORK_ERROR:"WALLET.ERR_NETWORK_FAULT",SERVER_ERROR:"WALLET.ERR_SERVER_FAULT",TIMEOUT:"WALLET.ERR_TIMEOUT",BAD_DATA:"WALLET.ERR_BAD_DATA",CANCELLED:"WALLET.ERR_CANCELLED",BUFFEER_OVERRUN:"WALLET.ERR_BUFFER_OVERRUN",NUMERIC_FAULT:"WALLET.ERR_NUMERIC_FAULT",INVALID_ARGUMENT:"WALLET.ERR_INVALID_ARGUMENT",INVALID_RESPONSE:"WALLET.ERR_INVALID_RESPONSE",MISSSING_ARGUMENT:"WALLET.ERR_MISSING_ARGUMENT",UNEXPECTED_ARGUMENT:"WALLET.ERR_UNEXPECTED_ARGUMENT",CALL_EXCEPTION:"WALLET.ERR_CALL_EXCEPTION",INSUFFICIEENT_FUNDS:"WALLET.ERR_INSUFFICIENT_FUNDS",NONCE_EXPIRED:"WALLET.ERR_NONCE_EXPIRED",REPLACEMENT_UNDERPRICED:"WALLET.ERR_REPLACEMENT_UNDERPRICED",TRANSACTION_REPLACED:"WALLET.ERR_TRANSACTION_REPLACED",UNCONFIGURED_NAME:"WALLET.ERR_UNCONFIGURED_NAME",OFFCHAIN_FAULT:"WALLET.ERR_OFFCHAIN_FAULT",ACTION_REJECTED:"WALLET.ERR_ACTION_REJECTED"}[t.code]??"WALLET.ERR_UNKNOWN",i=r,E=r,u=r,R=r;return"data"in t&&(i=n(t.data)),"message"in t&&(i=n(t.message)),"transaction"in t&&(i=n(t.transaction)),"reason"in t&&(i=n(t.reason)),{code:a,data:i,message:E,transaction:u,reason:R}}}var L;(L=c||(c={})).Signature={nameOf:function(e){let t=e.split(" ");if(0===t.length)return r;let a=E(t.at(1));if(a.none())return a;let i=a.unwrap(),u=E(i.split("(").at(0));if(u.none())return u;let R=u.unwrap();return n(R)}},L.SignatureBuilder=function(){let e,i,E,u,R,o;return e={name:function(r){return i=n(r),e},event:function(){return E=n("event"),e},external:function(){return E=n("external"),e},pure:function(){return u=n("pure"),e},view:function(){return u=n("view"),e},payload:function(...r){return R=n(r),e},returns:function(...r){return o=n(r),e},build:function(){if(i.none())return a("SIGNATURE_BUILDER.ERR_MISSING_NAME");let e=i.unwrap();if(E.none())return a("SIGNATURE_BUILDER.ERR_MISSING_TYPE");let n=E.unwrap();if("event"===n){let n=L.Selector.from(e,...R.unwrapOr([])),r=L.EventSignature.from(n);return t(r)}if("external"===n){let n=L.Selector.from(e,...R.unwrapOr([]));if(u.none()){let e=L.ExternalSignature.from(n);return t(e)}let r=u.unwrap();if("pure"===r){let e=L.ExternalPureSignature.from(n,...o.unwrapOr([]));return t(e)}if("view"===r){let e=L.ExternalViewSignature.from(n,...o.unwrapOr([]));return t(e)}}return a("SIGNATURE_BUILDER.ERR_MALFORMED_SIGNATURE")}},i=r,E=r,u=r,R=r,o=r,e},L.ExternalSignature={from:function(e){return`function ${e} external`}},L.ExternalViewSignature={from:function(e,...n){return`function ${e} external view returns (${L.Data.serialize(...n)})`}},L.ExternalPureSignature={from:function(e,...n){return`function ${e} external pure returns (${L.Data.serialize(...n)})`}},L.EventSignature={from:function(e){return`event ${e}`}},L.Selector={from:function(e,...n){return`${e}(${L.Data.serialize(...n)})`}},L.Data={serialize:function(...e){let n="";for(let r=0n;r<e.length;r++)0n!==r&&(n=", "),n+=e[Number(r)];return n}};export{c as Wallet};//# sourceMappingURL=mod.js.map